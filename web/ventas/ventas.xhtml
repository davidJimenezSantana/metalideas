<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core">

    <h:head>


        <meta charset="UTF-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <link rel="icon" href="../img/Logo/logo-removebg-preview.png" type="image/x-icon" />

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
              integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous"/>

        <!-- Boxicons CSS -->
        <link href='https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css' rel='stylesheet'/>

        <link rel="stylesheet" href="../style.css"/>

        <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css"></link>
        <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.2.3/css/buttons.dataTables.min.css"></link>


        <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.2.3/js/dataTables.buttons.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.html5.min.js"></script>
        <script type="text/javascript" src="https://cdn.datatables.net/buttons/2.2.3/js/buttons.print.min.js"></script> 


        <title>Ventas</title>

        <script>
            $(document).ready(function () {

                $('#tabla_ventas').DataTable({
                    dom: 'Bfrtip',
                    paging: false,
                    scrollY: 400,
                    language: {url: '//cdn.datatables.net/plug-ins/1.13.1/i18n/es-MX.json'},

                    buttons: [
                        'copy', 'csv', 'excel', 'pdf', 'print'
                    ]
                });
            });

            function cargar(id, total, destino, idestado, fecha, nombre, apellido, metodoPago, comprobante, idusuario) {
                document.getElementById("formularioEditar:idVenta").value = id;
                document.getElementById("formularioEditar:total").value = total;
                document.getElementById("formularioEditar:destino").value = destino;
                document.getElementById("formularioEditar:idestado").value = idestado;
                document.getElementById("formularioEditar:fecha").value = fecha;
                document.getElementById("formularioEditar:nombre").value = nombre;
                document.getElementById("formularioEditar:apellido").value = apellido;
                document.getElementById("formularioEditar:metodoPago").value = metodoPago;
                document.getElementById("formularioEditar:comprobante").value = comprobante;
                document.getElementById("formularioEditar:idusuario").value = idusuario;
            }

        </script>

    </h:head>



    


        <header id="header-administrador">
            <nav class="navbar navbar-expand-lg navbar-light">
                <div class="container">
                    <a class="navbar-brand" href="Bienvenida.html"><img class="logoMetalideas" src="../img/Metalideas.png"
                                                                        alt="Metalideas"/></a>
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                            data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false"
                            aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                        <div class="navbar-nav">
                            <a class="nav-link close__sidebar" href="#">
                                <i class='bx bx-menu'></i>
                                Menu
                            </a>
                            <a class="nav-link" aria-current="page" href="../Bienvenida.xhtml">
                                <i class='bx bx-user'></i>
                                Mi perfil
                            </a>
                            <a class="nav-link" href="../index.xhtml">
                                <i class='bx bx-exit'></i>
                                Salir
                            </a>
                        </div>
                    </div>
                </div>
            </nav>
        </header>

        <div class="sidebar " id="sidebar">
            <div class="logo close__sidebar">
                <i class='bx bx-menu'></i>
                <span class="logo__nombre">Menú</span>
            </div>

            <div class="contenedor-menu">
                <div class="nav-menu1">
                    <ul class="nav-links">                        
                        <li>
                            <a href="inventario.xhtml">
                                <i class='link-icon bx bx-package'></i>
                                <span class="link-nombre">GESTIÓN INVENTARIO</span>
                            </a>
                        </li>
                    </ul>
                    <ul class="nav-links">                        
                        <li>
                            <a href="ventas/ventas.xhtml">
                                <i class='link-icon bx bx-spreadsheet'></i>
                                <span class="link-nombre">GESTIÓN VENTAS</span>
                            </a>
                        </li>
                    </ul>
                </div>

                <div class="nav-menu2">
                    <div class="sidebarUsuarios__titulo">
                        <span>USUARIOS</span>
                    </div>
                    <ul class="nav-links">
                        <li>
                            <a href="../Bienvenida.xhtml">
                                <i class='link-icon bx bxs-user-account'></i>
                                <span class="link-nombre">VER PERFIL</span>
                            </a>
                        </li>

                        <li>
                            <a href="#">
                                <i class='link-icon bx bx-user'></i>
                                <span class="link-nombre">CAMBIO DE CONTRASEÑA</span>
                            </a>
                        </li>

                        <li>
                            <a href="../index.xhtml">
                                <i class='link-icon bx bx-exit'></i>
                                <span class="link-nombre">SALIR</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>

        </div>


        <div class="container">
            <div class="row titulo-Gestion">
                <h1>Gestión de ventas</h1>
            </div>
            <div class="row form-Gestion">
                <div class="col-2">                
                </div>
                <div class="col-2">

                </div>
                <div class="col-4">
                    <div class="row">
                        <div class="col-3">                        
                        </div>
                        <div class="col-9">
                            <div class="row">
                                <div class="col-6 btn-form">
                                </div>
                                <div class="col-6 btn-form">
                                    <button class="abrirCerrarFormAdd"><i class='bx bxs-add-to-queue'></i>Agregar venta</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
            <div class="row ">
                <div class="col-8">
                    <div class="contenedor-tabla">
                        <h:dataTable class="table" id="tabla_ventas" value="#{ventas.findAllVentas()}" var="item">

                            <h:column>
                                <f:facet name="header"> Estado </f:facet>
                                <h:outputText value="#{item.estadoIdestado.nombre}"></h:outputText>
                            </h:column>
                            <h:column>
                                <f:facet name="header"> Destino </f:facet>
                                <h:outputText value="#{item.destino}"></h:outputText>
                            </h:column>
                            <h:column>
                                <f:facet name="header"> Total </f:facet>
                                <h:outputText value="#{item.total}"></h:outputText>
                            </h:column>
                            <h:column>
                                <f:facet name="header"> fecha </f:facet>
                                <h:outputText value="#{item.fecha}" >
                                    <f:convertDateTime pattern="dd/MM/yyyy" />
                                </h:outputText>
                            </h:column>
                            <h:column>
                                <f:facet name="header"> Usuario </f:facet>
                                <h:outputText value="#{item.usuarioIdusuario.nombre}"></h:outputText>
                            </h:column>
                            <h:column>
                                <f:facet name="header"> inf. </f:facet>
                                <h:outputText value=""></h:outputText>
                            </h:column>
                            <h:column>
                                <f:facet name="header"> Acción </f:facet>
                                <h:form id="formulario">
                                    <div class="opc-tabla">
                                        <a class='bx bx-cog iconos abrirCerrarFormEdit' id="opc-form" href="javascript:cargar('#{item.idventa}','#{item.total}','#{item.destino}','#{item.estadoIdestado.idestado}','#{item.fecha}','#{item.usuarioIdusuario.nombre}','#{item.usuarioIdusuario.apellido}','#{item.metodoPagoIdmetodoPago.idmetodoPago}','#{item.comprobanteDePagoIdcomprobanteDePago.idcomprobanteDePago}','#{item.usuarioIdusuario.idusuario}')">Editar</a>     
                                        <h:commandButton  action="#{ventas.borrar(item.idventa)}" value="Eliminar"></h:commandButton>                                        
                                    </div>
                                </h:form>                                
                            </h:column> 
                        </h:dataTable>
                    </div>
                </div>
            </div>
        </div>


        <!--  -->
        <!-- FORMULARIO DE AGREGAR -->
        <!--  -->



        <div class="form-lateral" id="agregarForm">
            <div class="form-gestion">
                <div class="contenedor-formulario" id="contenedor-formulario">
                    <div class="row">
                        <div class="cerrar-form">
                            <i class='bx bx-x abrirCerrarFormAdd iconos'></i>
                        </div>
                    </div>
                    <div class="row titulo-form">
                        <h1><i class='bx bx-add-to-queue'></i>Agregar producto</h1>
                    </div>
                    <h:form  class="needs-validation" id="formAgregar">
                        <div class='row'>
                            <div class="col-6">
                                <div class="campo-form">
                                    <label for="total">Total de la venta: $</label>
                                    <h:inputText  value="#{ventas.venta.total}"></h:inputText>
                                </div>
                                <div class="campo-form">
                                    <h:outputLabel  for="metodoPago">Metodo de pago:</h:outputLabel>                
                                    <h:selectOneMenu value="#{ventas.idmetodoPago}">
                                        <f:selectItems value="#{ventas.findAllMetodosPago()}" var="item" 
                                                       itemValue="#{item.idmetodoPago}" itemLabel="#{item.nombre}"/>
                                    </h:selectOneMenu>
                                </div>
                            </div>
                            <div class="col-6">
                                <div class="campo-form">
                                    <label for="destino">Destino:</label>
                                    <h:inputText  value="#{ventas.venta.destino}" ></h:inputText> 
                                </div>  
                                <div class="campo-form">
                                    <h:outputLabel   for="idestado">Estado:</h:outputLabel>                
                                    <h:selectOneMenu  value="#{ventas.idestadoVenta}">
                                        <f:selectItems value="#{ventas.findAllEstados()}" var="item" 
                                                       itemValue="#{item.idestado}" itemLabel="#{item.nombre}"/>
                                    </h:selectOneMenu>
                                </div>
                            </div>
                        </div>

                        <div class='row campo-form'>
                            <label for="fecha">Comprador</label>    
                            <h:outputLabel   for="idestado">Comprador: </h:outputLabel>                
                            <h:selectOneMenu  value="#{ventas.idusuario}">
                                <f:selectItems value="#{ventas.findAllUsuario()}" var="item" 
                                               itemValue="#{item.idusuario}" itemLabel="#{item.nombre} #{item.apellido}"/>
                            </h:selectOneMenu>
                        </div>

                        <div class="row btn-formulario">
                            <h:commandButton value="Agregar" action="#{inventario.agregar()}"></h:commandButton>
                        </div>
                    </h:form>
                </div>
            </div>
        </div>

        <!--  -->
        <!-- FORMULARIO DE EDITAR -->
        <!--  -->        

        <div class="form-lateral" id="editarForm">
            <div class="form-gestion">
                <div class="contenedor-formulario" id="contenedor-formulario">
                    <div class="row">
                        <div class="cerrar-form">
                            <i class='bx bx-x abrirCerrarFormEdit iconos'></i>
                        </div>
                    </div>
                    <div class="row titulo-form">
                        <h1><i class='bx bx-cog'></i>Editar Venta</h1>
                    </div>
                    <h:form id="formularioEditar" class="needs-validation" >
                        <h:inputHidden id="idVenta" value="#{ventas.venta.idventa}"></h:inputHidden>
                        <h:inputHidden id="metodoPago" value="#{ventas.idmetodoPago}"></h:inputHidden>
                        <h:inputHidden id="comprobante" value="#{ventas.idcomprobante}"></h:inputHidden>
                        <h:inputHidden id="idusuario" value="#{ventas.idusuario}"></h:inputHidden>
                        <div class="row">
                            <div class="col-6">
                                <div class="campo-form">
                                    <label for="total">Total de la venta: $</label>
                                    <h:inputText style='color:snow;' disabled="true" id="total" value="#{ventas.venta.total}"></h:inputText>
                                </div>
                                <div class="campo-form">
                                    <label for="destino">Destino:</label>
                                    <h:inputText id="destino" value="#{ventas.venta.destino}" ></h:inputText> 
                                </div>                                
                            </div>
                            <div class="col-6">
                                <div class="campo-form">
                                    <label for="fecha">Fecha</label>
                                    <h:inputText  style='color:snow;' id="fecha" value='#{ventas.venta.fecha}' disabled="true"></h:inputText>
                                </div>
                                <div class="campo-form">
                                    <h:outputLabel  style='color:snow;' for="idestado">Estado:</h:outputLabel>                
                                    <h:selectOneMenu id="idestado" value="#{ventas.idestadoVenta}">
                                        <f:selectItems value="#{ventas.findAllEstados()}" var="item" 
                                                       itemValue="#{item.idestado}" itemLabel="#{item.nombre}"/>
                                    </h:selectOneMenu>
                                </div>

                            </div>
                            <div class='row'>
                                <label for="fecha">Comprador</label>
                                <div class='col-6'>
                                    <div class="campo-form">                                        
                                        <h:inputText id="nombre" value="#{ventas.venta.usuarioIdusuario.nombre}" disabled="true" style='color:snow;' ></h:inputText>
                                    </div>
                                </div>  
                                <div class='col-6'>
                                    <div class="campo-form">                                        
                                        <h:inputText id="apellido" value="#{ventas.venta.usuarioIdusuario.apellido}" disabled="true" style='color:snow;'></h:inputText>
                                    </div>
                                </div>  
                            </div>                           
                        </div>
                        <div class="row btn-formulario">
                            <h:commandButton value="Editar" action="#{ventas.editar()}"></h:commandButton>
                        </div>
                    </h:form>
                </div>
            </div>
        </div>




        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>

        <script src="../JS.js"></script>

    
</html>



